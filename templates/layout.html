<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>{% block title %}Oficina{% endblock %}</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">

    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#0d6efd">

    <!-- Apple -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="/static/img/logo-192.png">
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" href="/">ðŸš— Oficina Digital</a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
            data-bs-target="#nav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="nav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link {% if request.path == '/' %}active{% endif %}" href="/">InÃ­cio</a></li>
        <li class="nav-item"><a class="nav-link {% if request.path.startswith('/servicos') %}active{% endif %}" href="/servicos">ServiÃ§os</a></li>
        <li class="nav-item"><a class="nav-link {% if request.path.startswith('/solicitar') %}active{% endif %}" href="/solicitar">Solicitar</a></li>
        <li class="nav-item"><a class="nav-link" href="/painel">Painel</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container mt-4">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show">
          {{ message }}
          <button class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  {% block content %}{% endblock %}
</div>

<footer class="bg-dark text-white text-center py-3 mt-5">
  Â© 2025 Oficina Digital
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- REGISTRO DO SERVICE WORKER FINAL -->
<script>
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("/static/service-worker.js")
      .then(() => console.log("SW registrado com sucesso"))
      .catch(err => console.log("Erro ao registrar SW:", err));
}
</script>


<!-- TOAST DE INSTALAÃ‡ÃƒO DO PWA -->
<div id="pwa-toast" style="
    display:none;
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: #ffffff;
    padding: 16px;
    width: 90%;
    max-width: 350px;
    border-radius: 12px;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    z-index: 9999;
    flex-direction: column;
">
    <strong style="font-size: 18px;">Instalar aplicativo</strong>
    <p style="margin: 8px 0 16px;">Instale o app da Oficina para acesso rÃ¡pido.</p>

    <div style="display: flex; justify-content: flex-end; gap: 10px;">
        <button id="btn-close-toast"
            style="border:none;background:transparent;font-size:14px;cursor:pointer;">
            Agora nÃ£o
        </button>

        <button id="btn-install"
            style="padding:8px 14px;background:#28a745;color:white;border:none;border-radius:6px;cursor:pointer;">
            Instalar
        </button>
    </div>
</div>

<script>
  let deferredPrompt;

  window.addEventListener("beforeinstallprompt", (e) => {
      console.log("beforeinstallprompt disparado");
      e.preventDefault();
      deferredPrompt = e;

      // mostrar o seu toast
      document.getElementById("pwa-toast").style.display = "flex";
  });

  // botÃ£o "instalar"
  document.getElementById("btn-install").addEventListener("click", async () => {
      if (!deferredPrompt) return;

      deferredPrompt.prompt();
      const result = await deferredPrompt.userChoice;

      console.log("Resultado da instalaÃ§Ã£o:", result);

      deferredPrompt = null;
      document.getElementById("pwa-toast").style.display = "none";
  });

  // botÃ£o "agora nÃ£o"
  document.getElementById("btn-close-toast").addEventListener("click", () => {
      document.getElementById("pwa-toast").style.display = "none";
  });
</script>


</body>
</html>
